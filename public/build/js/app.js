function darkMode(){const e=window.matchMedia("(prefers-color-scheme: dark)");e.matches?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),e.addEventListener("change",(function(){e.matches?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")}));document.querySelector(".dark-mode-boton").addEventListener("click",(function(){document.body.classList.toggle("dark-mode")}))}function tipoMascota(){const e=document.querySelector("#animal");e.addEventListener("change",(function(){const t=document.getElementById("raza");t.innerHTML="";const o=document.createElement("option");o.text="-- Selecciona --",t.appendChild(o);const a=e.value;fetch("/usuario/mascota/raza?numero="+a).then(e=>e.json()).then(e=>{e.length>0&&e.forEach(e=>{const o=document.createElement("option");o.value=e.id,o.text=e.raza,t.appendChild(o)})}).catch(e=>console.error(e))}))}function subirPublicacion(){var e=document.getElementById("formularioPublicacion"),t=new FormData(e);fetch("publicar",{method:"POST",body:t}).then((function(e){if(e.ok)return e.json();throw new Error("Error en la solicitud.")})).then((function(e){if(!0===e){Swal.mixin({customClass:{confirmButton:"btn btn-success"},buttonsStyling:!1}).fire({title:"¡Exito!",text:"¡Tu publicación fue creada con exito!",icon:"success",confirmButtonText:"Aceptar",reverseButtons:!0}).then(e=>{e.isConfirmed&&(window.location.href="index")})}else Swal.fire("¡Error!","¡Error en la solicitud.!","warning"),console.log("La respuesta fue false.")})).catch((function(e){console.log(e)}))}function fotosPublicaciones(){if(console.log(window.location.href),window.location.href.endsWith("index")){console.log("estamos en la pagina");for(var e=document.getElementsByClassName("idPublicacion"),t=0;t<e.length;t++){var o=e[t].getAttribute("data-id");console.log("idPublicacion seleccionado:",o)}}}function seleccionarProducto(e){null==localStorage.getItem("listado")?(console.log("No hay nada en el localStorage"),lista=[],cantTemp=0):(console.log("si hay algo en el localStorage y es lo siguiente: "),lista=JSON.parse(localStorage.getItem("listado")),indice=lista.findIndex(t=>t.id===e.toString()),-1!==indice?(cantTemp=lista[indice].cantidad,console.log("el indice encontrado en el localStorage: "+indice)):(cantTemp=0,console.log("No existe el producto en el localstorage")),console.log(lista)),fetch("/api/producto?id="+e).then(e=>e.json()).then(e=>{if(e.Error)Swal.fire({icon:"error",title:"Usuario no logueado...",text:"Por favor para poder comprar inicia sesión o crea una cuenta.",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&(window.location.href="/login")});else if(e.length>0){const t=e[0],o=parseInt(t.stock)-cantTemp;0===parseInt(o)&&parseInt(t.stock)>1?Swal.fire({icon:"error",title:"Producto en carrito",text:"Ya tienes todo el stock del producto en el carrito, pero aun no es tuyo. Ve al carrito a finalizar tu compra antes de que alguien mas te lo gane.",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&(window.location.href="/carrito")}):cantTemp>=1?Swal.fire({icon:"warning",title:"¡Producto en el carrito!",text:"¿Ya tienes este producto en el carrito deseas agregar mas unidades?",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No, me equivoque de producto"}).then(e=>{e.isConfirmed&&Swal.fire({title:t.nombre,icon:"info",input:"number",inputLabel:`Ya tienes ${cantTemp} unidades. ¿Cuantas unidades quieres agregar?`,inputAttributes:{min:1,max:o,step:1},inputValue:1,confirmButtonText:"Agregar al carrito",inputValidator:e=>parseInt(e)>o?"Alerta: la cantidad es superior al stock del producto!":parseInt(e)<1?"Alerta: la cantidad es menor al stock del producto!":void 0}).then(e=>{e.isConfirmed&&(productoExiste=lista.findIndex(e=>e.id===t.id),-1!==productoExiste?lista[productoExiste].cantidad=parseInt(lista[productoExiste].cantidad)+parseInt(e.value):lista.push({id:t.id,nombre:t.nombre,cantidad:e.value,precio:t.precio}),localStorage.setItem("listado",JSON.stringify(lista)),Swal.fire("Se han agregado "+e.value+" productos al carrito de compras"))})}):Swal.fire({title:t.nombre,icon:"info",input:"number",inputLabel:"¿Cuantas unidades quieres?",inputAttributes:{min:1,max:o,step:1},inputValue:1,confirmButtonText:"Agregar al carrito",inputValidator:e=>parseInt(e)>o?"Alerta: la cantidad es superior al stock del producto!":parseInt(e)<1?"Alerta: la cantidad es menor al stock del producto!":void 0}).then(e=>{e.isConfirmed&&(productoExiste=lista.findIndex(e=>e.id===t.id),-1!==productoExiste?(console.log(lista[productoExiste].cantidad),lista[productoExiste].cantidad=e.value):lista.push({id:t.id,nombre:t.nombre,cantidad:e.value,precio:t.precio}),localStorage.setItem("listado",JSON.stringify(lista)),Swal.fire("Se han agregado "+e.value+" productos al carrito de compras"))})}}).catch(e=>console.error(e))}function eliminarProducto(e){null==localStorage.getItem("listado")?(console.log("No hay nada en el localStorage"),lista=[],cantTemp=0):(console.log("si hay algo en el localStorage y es lo siguiente: "),lista=JSON.parse(localStorage.getItem("listado")),indice=lista.findIndex(t=>t.id===e.toString()),-1!==indice?(cantTemp=lista[indice].cantidad,console.log("el indice encontrado en el localStorage: "+indice)):(cantTemp=0,console.log("No existe el producto en el localstorage")),console.log(lista)),productoExiste=lista.findIndex(t=>t.id===e.toString()),-1!==productoExiste&&(productosLista=lista.filter(t=>t.id!==e.toString()),console.log(productosLista),localStorage.setItem("listado",JSON.stringify(productosLista)),Swal.fire("Se ha eliminado el articulo "+e+" del carrito de compras"),setTimeout(()=>{},2e3),location.reload())}function carrito(){divCarrito=document.getElementById("productos-carrito"),null==localStorage.getItem("listado")?(console.log("No hay nada en el localStorage"),lista=[],cantTemp=0):(console.log("si hay algo en el localStorage y es lo siguiente: "),lista=JSON.parse(localStorage.getItem("listado")),lista.forEach(e=>{const t=document.createElement("div");t.classList.add("card");const o=document.createElement("div");o.classList.add("info");const a=document.createElement("div");a.classList.add("botones-carrito");const n=document.createElement("h2");n.textContent=e.nombre;const i=document.createElement("p");i.textContent="Cantidad: "+e.cantidad;const c=document.createElement("p");c.textContent="Precio: $"+e.precio;const l=document.createElement("button");l.textContent="Actualizar",l.addEventListener("click",()=>{seleccionarProducto(e.id)});const r=document.createElement("button");r.textContent="Eliminar",r.addEventListener("click",()=>{eliminarProducto(e.id)}),o.appendChild(n),o.appendChild(i),o.appendChild(c),a.appendChild(l),a.appendChild(r),t.appendChild(o),t.appendChild(a),divCarrito.appendChild(t)}),console.log(lista))}document.addEventListener("DOMContentLoaded",(function(){darkMode(),fotosPublicaciones(),carrito()}));